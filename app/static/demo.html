<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marksheet Extraction API - Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body {
            background: #f3f4f6;
            min-height: 100vh;
        }
        
        .hero-section {
            background: var(--bg-gradient);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        
        .upload-zone {
            border: 3px dashed #d1d5db;
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--primary-color);
            background: #f5f3ff;
        }
        
        .upload-zone i {
            font-size: 4rem;
            color: #9ca3af;
            margin-bottom: 1rem;
        }
        
        .upload-zone.dragover i {
            color: var(--primary-color);
        }
        
        .result-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .result-header {
            background: var(--bg-gradient);
            color: white;
            padding: 1.5rem;
        }
        
        .confidence-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .confidence-high { background: #d1fae5; color: #065f46; }
        .confidence-medium { background: #fef3c7; color: #92400e; }
        .confidence-low { background: #fee2e2; color: #991b1b; }
        
        .field-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .field-row:last-child {
            border-bottom: none;
        }
        
        .field-name {
            font-weight: 500;
            color: #374151;
        }
        
        .field-value {
            font-weight: 600;
            color: #111827;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .subject-card {
            background: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            background: white;
            padding: 2rem 3rem;
            border-radius: 1rem;
            text-align: center;
        }
        
        .json-view {
            background: #1f2937;
            color: #10b981;
            padding: 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stats-label {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .tab-content {
            padding-top: 1.5rem;
        }
        
        .nav-pills .nav-link {
            color: #374151;
            border-radius: 0.5rem;
        }
        
        .nav-pills .nav-link.active {
            background: var(--primary-color);
        }
        
        .api-key-input {
            font-family: monospace;
        }
        
        #fileInput {
            display: none;
        }
        
        /* Batch processing styles */
        .batch-file-item {
            background: #f9fafb;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .batch-file-item .file-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .batch-file-item .status-badge {
            font-size: 0.75rem;
        }
        
        .batch-result-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .batch-result-card.success {
            border-left-color: var(--success-color);
        }
        
        .batch-result-card.error {
            border-left-color: #ef4444;
        }
        
        .batch-progress {
            height: 8px;
            border-radius: 4px;
        }
        
        .mode-tabs .nav-link {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
        }
        
        .mode-tabs .nav-link.active {
            background: var(--primary-color);
            color: white;
        }
        
        #batchFileInput {
            display: none;
        }
        
        .batch-upload-zone {
            border: 3px dashed #d1d5db;
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fafafa;
        }
        
        .batch-upload-zone:hover, .batch-upload-zone.dragover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }
        
        .batch-upload-zone i {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .batch-files-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .batch-summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .batch-result-table {
            font-size: 0.875rem;
        }
        
        .batch-result-table .success-row {
            background-color: rgba(16, 185, 129, 0.1);
        }
        
        .batch-result-table .error-row {
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .download-json-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5>Processing Marksheet...</h5>
            <p class="text-muted mb-0">Extracting data using ai</p>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div>
                   Currently this ai is supported for only gemini api. Please use gemini api key.
                </div>
                <a href="/docs" class="btn btn-light btn-lg me-2">
                        <i class="fas fa-book me-2"></i>API Docs
                    </a>
                    <a href="/api/v1/health" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-heartbeat me-2"></i>Health
                    </a>
               <div class="mt-3 text-center">
    <button class="btn btn-success w-100" onclick="runDummyTest()">
        <i class="fas fa-play-circle me-2"></i>Run Dummy Test (semister1.pdf)
    </button>
    <small class="text-muted d-block mt-1">
        <i class="fas fa-info-circle me-1"></i>Test with a sample PDF file
    </small>
</div>

            </div>
        </div>
    </section>

    <div class="container pb-5">
        <!-- API Settings Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title mb-3">
                            <i class="fas fa-cog me-2 text-primary"></i>API Settings
                        </h6>
                        <div class="row align-items-center mb-3">
                            <div class="col-md-2">
                                <label class="form-label fw-semibold mb-0">Model</label>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="modelSelect">
                                    <option value="gemini" selected>Gemini (Google AI)</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-semibold mb-0">API Key</label>
                                <small class="text-muted d-block">Optional</small>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="password" class="form-control" 
                                           id="apiKeyInput" placeholder="Your Gemini API key">
                                    <a href="https://aistudio.google.com/apikey" target="_blank" class="btn btn-outline-primary">
                                        <i class="fas fa-key"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Leave API key empty to use server's default key. Your key is only used for this session and not stored.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mode Selection Tabs -->
        <ul class="nav nav-pills mode-tabs mb-4 justify-content-center" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#singleMode" type="button">
                    <i class="fas fa-file me-2"></i>Single File
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#batchMode" type="button">
                    <i class="fas fa-folder-open me-2"></i>Batch Processing
                </button>
            </li>
        </ul>
        
        <div class="tab-content">
            <!-- Single File Mode -->
            <div class="tab-pane fade show active" id="singleMode">
                <div class="row">
                    <!-- Upload Section -->
                    <div class="col-lg-5 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title mb-4">
                                    <i class="fas fa-upload me-2 text-primary"></i>Upload Marksheet
                                </h5>
                                
                                <div class="upload-zone" id="uploadZone">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <h5>Drop your file here</h5>
                                    <p class="text-muted">or click to browse</p>
                                    <p class="small text-muted mb-0">
                                        Supports: JPG, PNG, PDF (Max 10MB)
                                    </p>
                                </div>
                                <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.pdf">
                                
                                <!-- Run Dummy Test Button -->
                                
                                
                                <!-- File Preview -->
                                <div id="previewSection" class="mt-4" style="display: none;">
                                    <h6 class="mb-3"><i class="fas fa-file me-2"></i>Selected File</h6>
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="flex-grow-1">
                                            <strong id="fileName"></strong>
                                            <br>
                                            <small class="text-muted" id="fileSize"></small>
                                        </div>
                                        <button class="btn btn-outline-danger btn-sm" onclick="clearFile()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <img id="imagePreview" class="preview-image mb-3" style="display: none;">
                                    <div id="pdfPreview" class="alert alert-info" style="display: none;">
                                        <i class="fas fa-file-pdf me-2"></i>PDF file selected
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="extractData()">
                                        <i class="fas fa-magic me-2"></i>Extract Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

            <!-- Results Section -->
            <div class="col-lg-7">
                <div id="resultsSection" style="display: none;">
                    <!-- Stats Row -->
                    <div class="row mb-4">
                        <div class="col-3">
                            <div class="stats-card">
                                <div class="stats-value" id="overallConfidence">-</div>
                                <div class="stats-label">Overall Confidence</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stats-card">
                                <div class="stats-value" id="subjectCount">-</div>
                                <div class="stats-label">Subjects</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stats-card">
                                <div class="stats-value" id="ocrConfidence">-</div>
                                <div class="stats-label">OCR Confidence</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stats-card">
                                <div class="stats-value" id="processingTime">-</div>
                                <div class="stats-label">Processing (ms)</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- OCR Stats Row -->
                    <div class="row text-center mb-3" id="ocrStatsRow" style="display: none;">
                        <div class="col-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-primary" id="totalWordsDetected">0</div>
                                <small class="text-muted">Words Detected</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-success" id="highConfWords">0</div>
                                <small class="text-muted">High Conf Words</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="fw-bold text-info" id="pagesProcessed">0</div>
                                <small class="text-muted">Pages Processed</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Extraction Method Badge -->
                    <div class="alert mb-4" id="extractionMethodAlert">
                        <i class="fas fa-cogs me-2"></i>
                        <strong>Extraction Method:</strong> <span id="extractionMethod">-</span>
                    </div>

                    <!-- Results Card -->
                    <div class="result-card">
                        <div class="result-header">
                            <h5 class="mb-0">
                                <i class="fas fa-check-circle me-2"></i>Extraction Results
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Tabs -->
                            <ul class="nav nav-pills mb-3" role="tablist">
                                <li class="nav-item">
                                    <button class="nav-link active" data-bs-toggle="pill" 
                                            data-bs-target="#formattedView">
                                        <i class="fas fa-table me-1"></i>Formatted
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" data-bs-toggle="pill" 
                                            data-bs-target="#jsonView">
                                        <i class="fas fa-code me-1"></i>JSON
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <!-- Formatted View -->
                                <div class="tab-pane fade show active" id="formattedView">
                                    <div id="candidateSection"></div>
                                    <div id="examSection"></div>
                                    <div id="subjectsSection"></div>
                                    <div id="resultSection"></div>
                                    <div id="metadataSection"></div>
                                </div>
                                
                                <!-- JSON View -->
                                <div class="tab-pane fade" id="jsonView">
                                    <div class="d-flex justify-content-end mb-2">
                                        <button class="btn btn-sm btn-outline-primary" onclick="copyJSON()">
                                            <i class="fas fa-copy me-1"></i>Copy JSON
                                        </button>
                                    </div>
                                    <pre class="json-view" id="jsonOutput"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Welcome Message -->
                <div id="welcomeMessage" class="text-center py-5">
                    <i class="fas fa-file-invoice fa-4x text-muted mb-4"></i>
                    <h4 class="text-muted">Upload a marksheet to get started</h4>
                    <p class="text-muted">
                        The AI will extract candidate details, subjects, marks, grades, and more.
                    </p>
                </div>

                <!-- Error Message -->
                <div id="errorSection" class="alert alert-danger" style="display: none;">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Error</h5>
                    <p id="errorMessage" class="mb-0"></p>
                </div>
            </div>
        </div>
    </div>
            
            <div class="tab-pane fade" id="batchMode">
                <div class="row">
                    <!-- Batch Upload Section -->
                    <div class="col-lg-5 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title mb-4">
                                    <i class="fas fa-folder-open me-2 text-primary"></i>Batch Upload
                                </h5>
                                
                                <div class="batch-upload-zone" id="batchUploadZone">
                                    <i class="fas fa-layer-group"></i>
                                    <h5>Drop multiple files here</h5>
                                    <p class="text-muted">or click to browse</p>
                                    <p class="small text-muted mb-0">
                                        Supports: JPG, PNG, PDF (Max 10MB each)
                                    </p>
                                </div>
                                <input type="file" id="batchFileInput" accept=".jpg,.jpeg,.png,.pdf" multiple>
                                
                                <div id="batchFilesSection" class="mt-4" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0"><i class="fas fa-list me-2"></i>Selected Files</h6>
                                        <button class="btn btn-outline-danger btn-sm" onclick="clearBatchFiles()">
                                            <i class="fas fa-trash me-1"></i>Clear All
                                        </button>
                                    </div>
                                    <div class="batch-files-list" id="batchFilesList"></div>
                                    
                                    <div id="batchProgressSection" class="mt-3" style="display: none;">
                                        <div class="d-flex justify-content-between small mb-1">
                                            <span>Processing...</span>
                                            <span id="batchProgressText">0/0</span>
                                        </div>
                                        <div class="progress batch-progress">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 id="batchProgressBar" role="progressbar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary w-100 mt-3" id="processBatchBtn" onclick="processBatchFiles()">
                                        <i class="fas fa-play me-2"></i>Process All Files
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Batch Results Section -->
                    <div class="col-lg-7">
                        <!-- Batch Results Summary -->
                        <div id="batchResultsSection" style="display: none;">
                            <div class="batch-summary-card mb-4">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="fs-2 fw-bold" id="batchTotalProcessed">0</div>
                                        <small>Total Processed</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="fs-2 fw-bold text-success" id="batchSuccessCount">0</div>
                                        <small>Successful</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="fs-2 fw-bold" style="color: #fbbf24;" id="batchFailedCount">0</div>
                                        <small>Failed</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Results Table -->
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="fas fa-table me-2"></i>Batch Results</h6>
                                    <button class="btn btn-sm btn-outline-primary" onclick="downloadAllResults()">
                                        <i class="fas fa-download me-1"></i>Download All JSON
                                    </button>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover batch-result-table mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>#</th>
                                                    <th>File Name</th>
                                                    <th>Status</th>
                                                    <th>Name</th>
                                                    <th>Total Marks</th>
                                                    <th>Result</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="batchResultsTableBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Batch Welcome Message -->
                        <div id="batchWelcomeMessage" class="text-center py-5">
                            <i class="fas fa-boxes fa-4x text-muted mb-4"></i>
                            <h4 class="text-muted">Upload multiple marksheets</h4>
                            <p class="text-muted">
                                Process multiple files at once. Results will be displayed in a table format.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedFile = null;
        let extractionResult = null;
        let batchFiles = [];
        let batchResults = [];

        // Drag and drop handling for single file
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            handleFile(e.target.files[0]);
        });
        
        const batchUploadZone = document.getElementById('batchUploadZone');
        const batchFileInput = document.getElementById('batchFileInput');
        
        batchUploadZone.addEventListener('click', () => batchFileInput.click());
        
        batchUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            batchUploadZone.classList.add('dragover');
        });

        batchUploadZone.addEventListener('dragleave', () => {
            batchUploadZone.classList.remove('dragover');
        });

        batchUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            batchUploadZone.classList.remove('dragover');
            handleBatchFiles(e.dataTransfer.files);
        });

        batchFileInput.addEventListener('change', (e) => {
            handleBatchFiles(e.target.files);
        });
        
        function handleBatchFiles(files) {
            const allowedTypes = ['image/jpeg', 'image/webp', 'image/png', 'application/pdf'];
            const maxSize = 10 * 1024 * 1024;
            
            for (const file of files) {
                if (!allowedTypes.includes(file.type)) {
                    alert(`Invalid file type: ${file.name}. Skipping...`);
                    continue;
                }
                if (file.size > maxSize) {
                    alert(`File too large: ${file.name}. Max size is 10MB. Skipping...`);
                    continue;
                }
                if (!batchFiles.some(f => f.name === file.name && f.size === file.size)) {
                    batchFiles.push(file);
                }
            }
            
            updateBatchFilesList();
        }
        
        function updateBatchFilesList() {
            const listContainer = document.getElementById('batchFilesList');
            const filesSection = document.getElementById('batchFilesSection');
            
            if (batchFiles.length === 0) {
                filesSection.style.display = 'none';
                return;
            }
            
            filesSection.style.display = 'block';
            
            let html = '';
            batchFiles.forEach((file, index) => {
                const icon = file.type === 'application/pdf' ? 'fa-file-pdf text-danger' : 'fa-file-image text-primary';
                const result = batchResults.find(r => r.fileName === file.name);
                let statusBadge = '<span class="badge bg-secondary status-badge">Pending</span>';
                
                if (result) {
                    statusBadge = result.success 
                        ? '<span class="badge bg-success status-badge">Success</span>'
                        : '<span class="badge bg-danger status-badge">Failed</span>';
                }
                
                html += `
                    <div class="batch-file-item" data-index="${index}">
                        <div class="file-info">
                            <i class="fas ${icon}"></i>
                            <div>
                                <div class="fw-semibold small">${file.name}</div>
                                <small class="text-muted">${formatBytes(file.size)}</small>
                            </div>
                        </div>
                        ${statusBadge}
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }
        
        function clearBatchFiles() {
            batchFiles = [];
            batchResults = [];
            batchFileInput.value = '';
            document.getElementById('batchFilesSection').style.display = 'none';
            document.getElementById('batchResultsSection').style.display = 'none';
            document.getElementById('batchWelcomeMessage').style.display = 'block';
        }
        
        async function processBatchFiles() {
            if (batchFiles.length === 0) return;
            
            const apiKey = document.getElementById('apiKeyInput').value;
            const model = document.getElementById('modelSelect').value;
            batchResults = [];
            
            // Show progress
            document.getElementById('batchProgressSection').style.display = 'block';
            document.getElementById('processBatchBtn').disabled = true;
            document.getElementById('batchWelcomeMessage').style.display = 'none';
            
            const progressBar = document.getElementById('batchProgressBar');
            const progressText = document.getElementById('batchProgressText');
            
            for (let i = 0; i < batchFiles.length; i++) {
                const file = batchFiles[i];
                progressText.textContent = `${i + 1}/${batchFiles.length}`;
                progressBar.style.width = `${((i + 1) / batchFiles.length) * 100}%`;
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    // Build URL with query parameters
                    let url = '/api/v1/extract?model=' + encodeURIComponent(model);
                    if (apiKey) {
                        url += '&apikey=' + encodeURIComponent(apiKey);
                    }
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok || !result.success) {
                        batchResults.push({
                            fileName: file.name,
                            success: false,
                            error: result.detail || result.error || 'Extraction failed',
                            data: null
                        });
                    } else {
                        batchResults.push({
                            fileName: file.name,
                            success: true,
                            error: null,
                            data: result.data,
                            processingTime: result.processing_time_ms,
                            extractionMethod: result.extraction_method
                        });
                    }
                } catch (error) {
                    batchResults.push({
                        fileName: file.name,
                        success: false,
                        error: error.message,
                        data: null
                    });
                }
                
                // Update file list status
                updateBatchFilesList();
            }
            
            document.getElementById('batchProgressSection').style.display = 'none';
            document.getElementById('processBatchBtn').disabled = false;
            
            displayBatchResults();
        }
        
        function displayBatchResults() {
            const resultsSection = document.getElementById('batchResultsSection');
            const tableBody = document.getElementById('batchResultsTableBody');
            
            const successCount = batchResults.filter(r => r.success).length;
            const failedCount = batchResults.filter(r => !r.success).length;
            
            document.getElementById('batchTotalProcessed').textContent = batchResults.length;
            document.getElementById('batchSuccessCount').textContent = successCount;
            document.getElementById('batchFailedCount').textContent = failedCount;
            
            let html = '';
            batchResults.forEach((result, index) => {
                const rowClass = result.success ? 'success-row' : 'error-row';
                
                if (result.success) {
                    const data = result.data;
                    const name = data.candidate?.name?.value || '-';
                    const totalMarks = data.result?.total_marks?.value || '-';
                    const resultStatus = data.result?.result_status?.value || '-';
                    const statusColor = resultStatus.toUpperCase().includes('PASS') ? 'success' : 
                                        resultStatus.toUpperCase().includes('FAIL') ? 'danger' : 'secondary';
                    
                    html += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td><small>${result.fileName}</small></td>
                            <td><span class="badge bg-success">Success</span></td>
                            <td><small>${name}</small></td>
                            <td>${totalMarks}</td>
                            <td><span class="badge bg-${statusColor}">${resultStatus}</span></td>
                            <td>
                                <button class="btn btn-outline-primary download-json-btn" 
                                        onclick="downloadSingleResult(${index})">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="btn btn-outline-info download-json-btn" 
                                        onclick="viewSingleResult(${index})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                } else {
                    html += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td><small>${result.fileName}</small></td>
                            <td><span class="badge bg-danger">Failed</span></td>
                            <td colspan="3"><small class="text-danger">${result.error}</small></td>
                            <td>-</td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = html;
            resultsSection.style.display = 'block';
        }
        
        function downloadSingleResult(index) {
            const result = batchResults[index];
            if (!result || !result.success) return;
            
            const blob = new Blob([JSON.stringify(result.data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${result.fileName.replace(/\.[^/.]+$/, '')}_extracted.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function viewSingleResult(index) {
            const result = batchResults[index];
            if (!result || !result.success) return;
            
            // Open in new window with formatted JSON
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                <head>
                    <title>${result.fileName} - Extraction Result</title>
                    <style>
                        body { font-family: Monaco, monospace; padding: 20px; background: #1a1a2e; color: #10b981; }
                        pre { white-space: pre-wrap; word-wrap: break-word; }
                    </style>
                </head>
                <body>
                    <h3 style="color: #fff;">${result.fileName}</h3>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                </body>
                </html>
            `);
        }
        
        function downloadAllResults() {
            const successfulResults = batchResults.filter(r => r.success);
            if (successfulResults.length === 0) {
                alert('No successful results to download');
                return;
            }
            
            const allData = successfulResults.map(r => ({
                fileName: r.fileName,
                data: r.data
            }));
            
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `batch_extraction_results_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        fileInput.addEventListener('change', (e) => {
            handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            if (!file) return;

            const allowedTypes = ['image/jpeg','image/webp', 'image/png', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showError('Invalid file type. Please upload JPG, PNG, or PDF.');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showError('File too large. Maximum size is 10MB.');
                return;
            }

            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatBytes(file.size);
            document.getElementById('previewSection').style.display = 'block';

            // Show preview
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('pdfPreview').style.display = 'none';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('pdfPreview').style.display = 'block';
            }

            hideError();
        }

        function clearFile() {
            selectedFile = null;
            fileInput.value = '';
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('welcomeMessage').style.display = 'block';
        }

        async function runDummyTest() {
            // Fetch the dummy test file from testdata
            showLoading(true);
            hideError();
            
            try {
                // Fetch the semister1.pdf file
                const response = await fetch('/testdata/semister1.pdf');
                if (!response.ok) {
                    throw new Error('Could not load test file: semister1.pdf');
                }
                
                const blob = await response.blob();
                const file = new File([blob], 'semister1.pdf', { type: 'application/pdf' });
                
                // Set as selected file and show preview
                selectedFile = file;
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = (file.size / 1024).toFixed(2) + ' KB';
                document.getElementById('previewSection').style.display = 'block';
                document.getElementById('welcomeMessage').style.display = 'none';
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('pdfPreview').style.display = 'block';
                
                // Now extract data
                const apiKey = document.getElementById('apiKeyInput').value;
                const model = document.getElementById('modelSelect').value;
                const formData = new FormData();
                formData.append('file', file);
                
                let url = '/api/v1/extract?model=' + encodeURIComponent(model);
                if (apiKey) {
                    url += '&apikey=' + encodeURIComponent(apiKey);
                }

                const extractResponse = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                const result = await extractResponse.json();

                if (!extractResponse.ok) {
                    throw new Error(result.detail || result.error || 'Extraction failed');
                }

                if (!result.success) {
                    throw new Error(result.error || 'Extraction failed');
                }

                extractionResult = result;
                displayResults(result);

            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        async function extractData() {
            if (!selectedFile) return;

            const apiKey = document.getElementById('apiKeyInput').value;
            const model = document.getElementById('modelSelect').value;
            const formData = new FormData();
            formData.append('file', selectedFile);

            showLoading(true);
            hideError();

            try {
                // Build URL with query parameters
                let url = '/api/v1/extract?model=' + encodeURIComponent(model);
                if (apiKey) {
                    url += '&apikey=' + encodeURIComponent(apiKey);
                }

                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.detail || result.error || 'Extraction failed');
                }

                if (!result.success) {
                    throw new Error(result.error || 'Extraction failed');
                }

                extractionResult = result;
                displayResults(result);

            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayResults(result) {
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';

            const data = result.data;

            // Stats
            document.getElementById('overallConfidence').textContent = 
                (data.extraction_confidence * 100).toFixed(1) + '%';
            document.getElementById('subjectCount').textContent = data.subjects.length;
            document.getElementById('processingTime').textContent = 
                result.processing_time_ms.toFixed(0);
            
            // OCR Confidence
            if (result.ocr_confidence !== null && result.ocr_confidence !== undefined) {
                document.getElementById('ocrConfidence').textContent = 
                    (result.ocr_confidence * 100).toFixed(1) + '%';
            } else {
                document.getElementById('ocrConfidence').textContent = 'N/A';
            }
            
            // Extraction Method
            const methodAlert = document.getElementById('extractionMethodAlert');
            const methodSpan = document.getElementById('extractionMethod');
            if (result.extraction_method === 'text_pdf_llm') {
                methodSpan.textContent = 'Direct PDF Text + LLM Structuring (Most Efficient - No OCR Needed)';
                methodAlert.className = 'alert alert-primary mb-4';
            } else if (result.extraction_method === 'ocr_llm') {
                methodSpan.textContent = 'Tesseract OCR + LLM Structuring (Open Source OCR - Cost Efficient)';
                methodAlert.className = 'alert alert-success mb-4';
            } else if (result.extraction_method === 'direct_llm_vision') {
                methodSpan.textContent = 'Direct LLM Vision (Fallback - OCR confidence too low)';
                methodAlert.className = 'alert alert-warning mb-4';
            } else {
                methodSpan.textContent = result.extraction_method || 'Unknown';
                methodAlert.className = 'alert alert-info mb-4';
            }
            
            // File type info
            if (result.file_type) {
                const fileTypeLabel = {
                    'text_pdf': ' Text-based PDF',
                    'image_pdf': ' Scanned/Image PDF',
                    'image': ' Image File'
                };
                methodSpan.textContent += ` | ${fileTypeLabel[result.file_type] || result.file_type}`;
            }
            
            // OCR Stats (if available)
            if (result.ocr_stats) {
                document.getElementById('ocrStatsRow').style.display = 'flex';
                document.getElementById('totalWordsDetected').textContent = result.ocr_stats.total_words_detected || 0;
                document.getElementById('highConfWords').textContent = result.ocr_stats.high_confidence_words || 0;
                document.getElementById('pagesProcessed').textContent = result.ocr_stats.pages_processed || 0;
            } else {
                document.getElementById('ocrStatsRow').style.display = 'none';
            }

            // Candidate Section
            renderSection('candidateSection', 'Candidate Details', [
                { name: 'Name', ...data.candidate.name },
                data.candidate.father_name && { name: "Father's Name", ...data.candidate.father_name },
                data.candidate.mother_name && { name: "Mother's Name", ...data.candidate.mother_name },
                { name: 'Roll Number', ...data.candidate.roll_number },
                data.candidate.registration_number && { name: 'Registration No', ...data.candidate.registration_number },
                data.candidate.date_of_birth && { name: 'Date of Birth', ...data.candidate.date_of_birth },
            ].filter(Boolean));

            // Examination Section
            renderSection('examSection', 'Examination Details', [
                { name: 'Examination', ...data.examination.exam_name },
                { name: 'Year', ...data.examination.exam_year },
                { name: 'Board/University', ...data.examination.board_university },
                data.examination.institution_name && { name: 'Institution', ...data.examination.institution_name },
                data.examination.course_name && { name: 'Course', ...data.examination.course_name },
            ].filter(Boolean));

            // Subjects Section
            renderSubjects(data.subjects);

            // Result Section - with status highlighting
            renderResultSection(data.result);

            // Metadata Section
            renderSection('metadataSection', 'Document Information', [
                { name: 'Document Type', ...data.metadata.document_type },
                data.metadata.issue_date && { name: 'Issue Date', ...data.metadata.issue_date },
                data.metadata.certificate_number && { name: 'Certificate No', ...data.metadata.certificate_number },
            ].filter(Boolean));

            // JSON View
            document.getElementById('jsonOutput').textContent = 
                JSON.stringify(data, null, 2);
        }

        function renderSection(elementId, title, fields) {
            const container = document.getElementById(elementId);
            let html = `<h6 class="section-title"><i class="fas fa-chevron-right me-2"></i>${title}</h6>`;
            
            fields.forEach(field => {
                html += `
                    <div class="field-row">
                        <span class="field-name">${field.name}</span>
                        <div>
                            <span class="field-value me-2">${field.value || '-'}</span>
                            ${getConfidenceBadge(field.confidence)}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function renderSubjects(subjects) {
            const container = document.getElementById('subjectsSection');
            let html = `<h6 class="section-title"><i class="fas fa-chevron-right me-2"></i>Subject-wise Marks (${subjects.length})</h6>`;
            
            subjects.forEach((subject, index) => {
                // Subject group badge
                const groupBadge = subject.subject_group ? 
                    `<span class="badge bg-secondary ms-2">${subject.subject_group.value}</span>` : '';
                
                // Calculate percentage for this subject
                let subjectPercentage = '';
                if (subject.obtained_marks && subject.max_marks && subject.max_marks.value > 0) {
                    const pct = ((subject.obtained_marks.value / subject.max_marks.value) * 100).toFixed(1);
                    subjectPercentage = `<span class="badge bg-${parseFloat(pct) >= 60 ? 'success' : parseFloat(pct) >= 40 ? 'warning' : 'danger'} ms-2">${pct}%</span>`;
                }
                
                // Grade badge with colors
                let gradeBadge = '';
                if (subject.grade && subject.grade.value) {
                    const gradeVal = subject.grade.value.toUpperCase();
                    const gradeColor = gradeVal.includes('A') ? 'success' : 
                                       gradeVal.includes('B') ? 'info' : 
                                       gradeVal.includes('C') ? 'warning' : 
                                       gradeVal.includes('F') ? 'danger' : 'secondary';
                    gradeBadge = `<span class="badge bg-${gradeColor} ms-2">Grade: ${subject.grade.value}</span>`;
                }
                
                // Subject code if available
                const subjectCode = subject.subject_code ? 
                    `<small class="text-muted">(${subject.subject_code.value})</small>` : '';
                
                html += `
                    <div class="subject-card">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="badge bg-primary me-2">${index + 1}</span>
                                <strong>${subject.subject_name.value}</strong> ${subjectCode}
                                ${groupBadge}
                            </div>
                            <div>
                                ${getConfidenceBadge(subject.subject_name.confidence)}
                            </div>
                        </div>
                        
                        <!-- Main Marks Display -->
                        ${subject.obtained_marks ? `
                            <div class="d-flex align-items-center mb-2">
                                <div class="bg-light rounded p-2 me-2">
                                    <span class="fs-5 fw-bold text-primary">${subject.obtained_marks.value}</span>
                                    ${subject.max_marks ? `<span class="text-muted"> / ${subject.max_marks.value}</span>` : ''}
                                </div>
                                ${subjectPercentage}
                                ${gradeBadge}
                            </div>
                        ` : ''}
                        
                        <!-- Additional Details Row -->
                        <div class="row small">
                            ${subject.grade_point ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Grade Point:</span> 
                                    <strong>${subject.grade_point.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.credits ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Credits:</span> 
                                    <strong>${subject.credits.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.theory_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Theory:</span> 
                                    <strong>${subject.theory_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.practical_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Practical:</span> 
                                    <strong>${subject.practical_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.oral_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Oral:</span> 
                                    <strong>${subject.oral_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.written_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Written:</span> 
                                    <strong>${subject.written_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.internal_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">Internal:</span> 
                                    <strong>${subject.internal_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.external_marks ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="text-muted">External:</span> 
                                    <strong>${subject.external_marks.value}</strong>
                                </div>
                            ` : ''}
                            ${subject.is_pass ? `
                                <div class="col-6 col-md-3 mb-1">
                                    <span class="badge bg-${subject.is_pass.value ? 'success' : 'danger'}">
                                        ${subject.is_pass.value ? 'PASS' : 'FAIL'}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                        ${renderComponents(subject.components)}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderComponents(components) {
            if (!components || components.length === 0) return '';
            
            let html = `
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted fw-semibold">
                        <i class="fas fa-list-ul me-1"></i>Detailed Breakdown (${components.length} components):
                    </small>
                    <div class="table-responsive mt-2">
                        <table class="table table-sm table-bordered mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Component</th>
                                    <th class="text-center">Obtained</th>
                                    <th class="text-center">Out Of</th>
                                    <th class="text-center">%</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            components.forEach(comp => {
                const name = comp.component_name ? comp.component_name.value : 'Unknown';
                const obtained = comp.obtained_marks ? comp.obtained_marks.value : '-';
                const maxMarks = comp.max_marks ? comp.max_marks.value : '-';
                
                // Calculate percentage for component
                let pctBadge = '-';
                if (comp.obtained_marks && comp.max_marks && comp.max_marks.value > 0) {
                    const pct = ((comp.obtained_marks.value / comp.max_marks.value) * 100).toFixed(1);
                    const pctColor = parseFloat(pct) >= 60 ? 'success' : parseFloat(pct) >= 40 ? 'warning' : 'danger';
                    pctBadge = `<span class="badge bg-${pctColor}">${pct}%</span>`;
                }
                
                html += `
                    <tr>
                        <td><small>${name}</small></td>
                        <td class="text-center"><strong>${obtained}</strong></td>
                        <td class="text-center text-muted">${maxMarks}</td>
                        <td class="text-center">${pctBadge}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div></div>';
            return html;
        }
        
        function renderResultSection(result) {
            const container = document.getElementById('resultSection');
            const status = result.result_status ? result.result_status.value : 'Unknown';
            const isPass = status.toUpperCase().includes('PASS');
            const statusClass = isPass ? 'bg-success' : (status.toUpperCase().includes('FAIL') ? 'bg-danger' : 'bg-warning');
            
            let html = `
                <h6 class="section-title"><i class="fas fa-chevron-right me-2"></i>Overall Result</h6>
                
                <!-- Main Result Status Badge -->
                <div class="text-center mb-3">
                    <span class="badge ${statusClass} fs-4 px-4 py-2">
                        <i class="fas ${isPass ? 'fa-check-circle' : 'fa-times-circle'} me-2"></i>
                        ${status}
                    </span>
                </div>
                
                <!-- Main Metrics Cards -->
                <div class="row g-2">
            `;
            
            // Total Marks - Prominent Display
            if (result.total_marks) {
                const maxMarks = result.max_total_marks ? result.max_total_marks.value : null;
                const earnedPct = maxMarks ? ((result.total_marks.value / maxMarks) * 100).toFixed(1) : null;
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-calculator text-primary mb-2 fs-4"></i>
                            <div class="fs-3 fw-bold text-primary">${result.total_marks.value}</div>
                            ${maxMarks ? `<div class="text-muted">out of <strong>${maxMarks}</strong></div>` : ''}
                            ${earnedPct ? `<small class="badge bg-${parseFloat(earnedPct) >= 60 ? 'success' : parseFloat(earnedPct) >= 40 ? 'warning' : 'danger'}">${earnedPct}% earned</small>` : ''}
                            <div><small class="text-muted">Total Marks</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Percentage
            if (result.percentage) {
                const pctColor = result.percentage.value >= 75 ? 'success' : 
                                 result.percentage.value >= 60 ? 'info' : 
                                 result.percentage.value >= 40 ? 'warning' : 'danger';
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-percent text-${pctColor} mb-2 fs-4"></i>
                            <div class="fs-3 fw-bold text-${pctColor}">${result.percentage.value}%</div>
                            <div><small class="text-muted">Percentage</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Division
            if (result.division) {
                const divVal = result.division.value.toUpperCase();
                const divColor = divVal.includes('FIRST') || divVal.includes('1ST') ? 'success' : 
                                 divVal.includes('SECOND') || divVal.includes('2ND') ? 'info' : 'warning';
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-medal text-${divColor} mb-2 fs-4"></i>
                            <div class="fs-5 fw-bold text-${divColor}">${result.division.value}</div>
                            <div><small class="text-muted">Division</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Grade
            if (result.grade) {
                const gradeVal = result.grade.value.toUpperCase();
                const gradeColor = gradeVal.includes('A') ? 'success' : 
                                   gradeVal.includes('B') ? 'info' : 
                                   gradeVal.includes('C') ? 'warning' : 'secondary';
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-star text-${gradeColor} mb-2 fs-4"></i>
                            <div class="fs-3 fw-bold text-${gradeColor}">${result.grade.value}</div>
                            <div><small class="text-muted">Grade</small></div>
                        </div>
                    </div>
                `;
            }
            
            // CGPA
            if (result.cgpa) {
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-chart-line text-warning mb-2 fs-4"></i>
                            <div class="fs-3 fw-bold text-warning">${result.cgpa.value}</div>
                            <div><small class="text-muted">CGPA</small></div>
                        </div>
                    </div>
                `;
            }
            
            // SGPA
            if (result.sgpa) {
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-chart-bar text-info mb-2 fs-4"></i>
                            <div class="fs-3 fw-bold text-info">${result.sgpa.value}</div>
                            <div><small class="text-muted">SGPA</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Total Credits
            if (result.total_credits) {
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-coins text-secondary mb-2 fs-4"></i>
                            <div class="fs-4 fw-bold text-secondary">${result.total_credits.value}</div>
                            <div><small class="text-muted">Credits Earned</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Rank
            if (result.rank) {
                html += `
                    <div class="col-6 col-md-4 text-center mb-3">
                        <div class="border rounded p-3 h-100 bg-light">
                            <i class="fas fa-trophy text-warning mb-2 fs-4"></i>
                            <div class="fs-4 fw-bold text-warning">#${result.rank.value}</div>
                            <div><small class="text-muted">Rank</small></div>
                        </div>
                    </div>
                `;
            }
            
            // Distinction
            if (result.distinction) {
                html += `
                    <div class="col-12 text-center mb-3">
                        <div class="alert alert-success py-2 mb-0">
                            <i class="fas fa-award me-2"></i>
                            <strong>${result.distinction.value}</strong>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function getConfidenceBadge(confidence) {
            if (!confidence && confidence !== 0) return '';
            
            const percentage = (confidence * 100).toFixed(0);
            let className = 'confidence-low';
            if (confidence >= 0.8) className = 'confidence-high';
            else if (confidence >= 0.5) className = 'confidence-medium';
            
            return `<span class="confidence-badge ${className}">${percentage}%</span>`;
        }

        function copyJSON() {
            const json = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(json).then(() => {
                alert('JSON copied to clipboard!');
            });
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('welcomeMessage').style.display = 'none';
        }

        function hideError() {
            document.getElementById('errorSection').style.display = 'none';
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
